---
import MenuOverlay from './MenuOverlay.astro'
---

<!-- Menu icon -->
<div title='Open menu'>
	<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' class='fill-current text-white cursor-pointer' id='menu-button'>
		<path d='M0 2v2h24V2Zm0 9v2h24v-2Zm0 9v2h24v-2Z'></path>
	</svg>
</div>

<MenuOverlay />

<script is:inline>
	// Define functions
	function openMenu() {
		const menuOverlay = document.getElementById('menu-overlay')
		console.log('Open menu button clicked')
		menuOverlay.style.opacity = '1'
		menuOverlay.style.visibility = 'visible'

		// Find all elements with "menu--hide" class and hide them
		const menuHide = document.querySelectorAll('.menu--hide')
		menuHide.forEach((el) => {
			el.style.opacity = 0
		})
	}

	function closeMenu(e) {
		const menuOverlay = document.getElementById('menu-overlay')
		console.log('Close menu overlay clicked')
		if (e.target === menuOverlay) {
			menuOverlay.style.opacity = '0'
			menuOverlay.style.visibility = 'hidden'
			setShowIntroFalse() // Call this function when the menu is closed
		}

    // Find all elements with "menu--hide" class and hide them
		const menuHide = document.querySelectorAll('.menu--hide')
		menuHide.forEach((el) => {
			el.style.opacity = 1
		})
	}

	function checkIntroOverlay() {
		// Check if 'showIntro' is not set to 'false'
		if (localStorage.getItem('showIntro') !== 'false') {
			openMenu() // Automatically open the menu if condition is met
		}
	}

	function setShowIntroFalse() {
		localStorage.setItem('showIntro', 'false') // Set 'showIntro' to 'false' in localStorage
		console.log('showIntro set to false in localStorage')
	}

	// Deal with eventHandlers
	document.addEventListener('DOMContentLoaded', () => {
		const menuOverlay = document.getElementById('menu-overlay')
		const menuButton = document.getElementById('menu-button')

		// Add event listeners
		menuButton.addEventListener('click', openMenu)
		menuOverlay.addEventListener('click', closeMenu)

		// Show once
		checkIntroOverlay() // Check and potentially show the intro overlay
	})

	document.addEventListener('astro:before-swap', () => {
		const menuOverlay = document.getElementById('menu-overlay')
		const menuButton = document.getElementById('menu-button')

		// Correctly remove event listeners using the named functions
		menuButton.removeEventListener('click', openMenu)
		menuOverlay.removeEventListener('click', closeMenu)
	})

	document.addEventListener('astro:after-swap', () => {
		const menuOverlay = document.getElementById('menu-overlay')
		const menuButton = document.getElementById('menu-button')

		// Add event listeners
		menuButton.addEventListener('click', openMenu)
		menuOverlay.addEventListener('click', closeMenu)
	})
</script>
